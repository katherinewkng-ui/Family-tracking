<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>血糖监测系统</title>
  <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@3.2.0/main.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/chart.js" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #calendar {
      margin: 20px auto;
      max-width: 900px;
    }
    #chart-container {
      width: 80%;
      margin: 0 auto;
      padding-top: 30px;
    }
    .data-input {
      display: flex;
      justify-content: space-between;
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>血糖监测</h1>
  <div id="calendar"></div>

  <div id="data-input-form">
    <h2>请输入血糖数据</h2>
    <div class="data-input">
      <label for="fasting">空腹血糖</label>
      <input type="number" id="fasting" placeholder="空腹血糖">
    </div>
    <div class="data-input">
      <label for="before-meal">第一餐前</label>
      <input type="number" id="before-meal" placeholder="第一餐前血糖">
    </div>
    <div class="data-input">
      <label for="after-meal">第一餐后2小时</label>
      <input type="number" id="after-meal" placeholder="第一餐后血糖">
    </div>
    <!-- 添加更多输入字段 -->
    <button onclick="saveData()">保存数据</button>
  </div>

  <div id="chart-container">
    <canvas id="bloodSugarChart"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@3.2.0/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let selectedDate = null;
    let bloodSugarData = {}; // 保存血糖数据

    // 初始化日历
    const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
      initialView: 'dayGridMonth',
      dateClick: function(info) {
        selectedDate = info.dateStr;
        alert('选择的日期: ' + selectedDate);
      }
    });
    calendar.render();

    // 保存血糖数据
    function saveData() {
      if (!selectedDate) {
        alert('请选择日期');
        return;
      }

      const fasting = document.getElementById('fasting').value;
      const beforeMeal = document.getElementById('before-meal').value;
      const afterMeal = document.getElementById('after-meal').value;

      if (!fasting || !beforeMeal || !afterMeal) {
        alert('请输入完整数据');
        return;
      }

      // 保存数据
      bloodSugarData[selectedDate] = {
        fasting,
        beforeMeal,
        afterMeal
      };

      // 清空输入框
      document.getElementById('fasting').value = '';
      document.getElementById('before-meal').value = '';
      document.getElementById('after-meal').value = '';

      // 更新折线图
      updateChart();
    }

    // 更新折线图
    function updateChart() {
      const labels = Object.keys(bloodSugarData);
      const fastingData = labels.map(date => parseFloat(bloodSugarData[date].fasting));
      const beforeMealData = labels.map(date => parseFloat(bloodSugarData[date].beforeMeal));
      const afterMealData = labels.map(date => parseFloat(bloodSugarData[date].afterMeal));

      const ctx = document.getElementById('bloodSugarChart').getContext('2d');
      const bloodSugarChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: '空腹血糖',
              data: fastingData,
              borderColor: 'blue',
              fill: false
            },
            {
              label: '第一餐前',
              data: beforeMealData,
              borderColor: 'green',
              fill: false
            },
            {
              label: '第一餐后2小时',
              data: afterMealData,
              borderColor: 'red',
              fill: false
            }
          ]
        }
      });
    }
  </script>
</body>
</html>
